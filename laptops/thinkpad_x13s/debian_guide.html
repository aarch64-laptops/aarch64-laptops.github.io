<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Installing Debian Trixie on Lenovo ThinkPad X13s | AArch64 Laptops</title>
<meta name="generator" content="Jekyll v3.9.4" />
<meta property="og:title" content="Installing Debian Trixie on Lenovo ThinkPad X13s" />
<meta name="author" content="üíª with ü©∂" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Providing the GNU/Linux community with resources for Arm laptops since 2019!" />
<meta property="og:description" content="Providing the GNU/Linux community with resources for Arm laptops since 2019!" />
<link rel="canonical" href="/laptops/thinkpad_x13s/debian_guide.html" />
<meta property="og:url" content="/laptops/thinkpad_x13s/debian_guide.html" />
<meta property="og:site_name" content="AArch64 Laptops" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Installing Debian Trixie on Lenovo ThinkPad X13s" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"üíª with ü©∂"},"description":"Providing the GNU/Linux community with resources for Arm laptops since 2019!","headline":"Installing Debian Trixie on Lenovo ThinkPad X13s","url":"/laptops/thinkpad_x13s/debian_guide.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="AArch64 Laptops" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">AArch64 Laptops</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/distro_integration.html">Distro Integration</a><a class="page-link" href="/about.html">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Installing Debian Trixie on Lenovo ThinkPad X13s</h1>
  </header>

  <div class="post-content">
    <p>This guide provides step-by-step instructions on how to install Debian Trixie with no prior knowledge required. While it looks a little long, it covers every step you need to go through to have a working, encrypted Debian installation and not kill Windows during the installation. The whole process should take around 1 hour of your time (not counting the time to create the recovery drive and download everything).</p>

<p>While most of the parts of this guide are similar to the normal Debian installation, some of the ThinkPad specific workarounds may change in the future. If you have any doubs it may be good to take a look at <a href="https://wiki.debian.org/InstallingDebianOn/Thinkpad/X13s">Debian Wiki Page</a>.</p>

<h2 id="disclaimer">Disclaimer</h2>
<p><span style="color:red"> While every effort has been made to accurately describe a safe installation process and the risk of losing your existing data is low, it is recommended to backup your important files on a different device in case of any failures during the process. </span></p>

<h2 id="preparation">Preparation</h2>
<p>Currently it is recommended to keep the existing Windows installation, as it‚Äôs the only way to use all of the device‚Äôs features (and it may be necessary to use it in the future for firmware updates). Because of that we need some preparation before installing Debian.</p>

<p>To complete this guide you will need two USB drives with at least 1GB and 32GB of capacity.</p>

<p><span style="color:red"> Make sure that your AC power adapter is connected, as the power loss during a few steps may result in data loss. </span></p>

<h3 id="free-up-disk-space">Free-up disk space</h3>
<p>Resizing partitions later is less convenient, so make sure you have enough free space on your disk before proceeding. 50GB should be enough just to try Debian, but if you want to use it daily reclaim as much space as possible.</p>

<h3 id="upgrade-system-firmware">Upgrade system firmware</h3>
<p>Go to the <a href="https://pcsupport.lenovo.com/gb/en/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x13s-type-21bx-21by/downloads/driver-list/component?name=BIOS%2FUEFI">Drivers &amp; Software</a> section of Lenovo‚Äôs website and download the latest BIOS Update Utility.
After installing the downloaded binary, <code class="language-plaintext highlighter-rouge">ThinkPad BIOS Flash Update Utility</code> will open automatically.</p>

<p><img src="debian_images/fwupdate_1.png" width="100%" /></p>

<p><img src="debian_images/fwupdate_2.png" width="100%" /></p>

<p>Proceed through the steps. Answer <code class="language-plaintext highlighter-rouge">No</code> to the <code class="language-plaintext highlighter-rouge">Would you like to update the machine model?</code>.</p>

<p>During the upgrade the ThinkPad will reboot.</p>

<h3 id="create-windows-recovery-disk">Create Windows Recovery Disk</h3>
<p>Currently it is not possible to download Windows 11 for ARM image from Microsoft, so the only way to reinstall it in case anything goes wrong is by using a recovery disk.</p>

<p>Before continuing unplug all external drives.</p>

<p>Open the start menu, type ‚Äúrecovery drive‚Äù and open the <code class="language-plaintext highlighter-rouge">Recovery Media Creator</code> tool. Make sure that <code class="language-plaintext highlighter-rouge">Back up system files to the recovery drive.</code> is selected and proceed:</p>

<p><img src="debian_images/recovery_1.png" width="100%" /></p>

<p>Plug in the 32GBs USB drive, select it, press <code class="language-plaintext highlighter-rouge">Next</code>, <code class="language-plaintext highlighter-rouge">Create</code> and wait for it to finish (it may take an hour).</p>

<p><span style="color:red">Note: all data on this drive will be deleted.</span></p>

<p><img src="debian_images/recovery_2.png" width="100%" /></p>

<h3 id="disable-bitlocker">Disable BitLocker</h3>
<p>By default ThinkPad encrypts your files using Windows BitLocker. It is recommended to disable it, because we will need to also disable the <code class="language-plaintext highlighter-rouge">Secure Boot</code> later in order to boot Debian. With the BitLocker still enabled, you would have to type in a 48 digit password each time you boot into Windows. Alternatively if you really want to keep it on, make sure that your recovery keys are backed up on a different device and shrink the Windows partition before proceeding.</p>

<p><span style="color:red">Note: from this moment files on your Windows partition will no longer be encrypted and they could become accessible by anyone with access to your laptop.</span></p>

<p>To disable it, open the start menu, type ‚Äúbitlocker‚Äù and open <code class="language-plaintext highlighter-rouge">Manage BitLocker</code> tool:</p>

<p><img src="debian_images/bitlocker_1.png" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Turn off BitLocker</code> and wait for the ‚ÄúBitLocker Decrypting‚Äù to change to ‚ÄúBitLocker off‚Äù. You may check the progress by opening the notification that popped up. It may take some time if you have a lot of files on your drive.</p>

<p><img src="debian_images/bitlocker_2.png" width="100%" /></p>

<p><img src="debian_images/bitlocker_3.png" width="100%" /></p>

<h3 id="store-wi-fi-and-bluetooth-mac-addresses">Store Wi-Fi and Bluetooth mac addresses</h3>
<p>As the physical addresses of your Wi-Fi and Bluetooth cards cannot be read by Linux kernel (yet), you will need to note them now to restore them under Debian.</p>

<p>Right-click on the Start menu and open <code class="language-plaintext highlighter-rouge">Terminal (Admin)</code>.</p>

<p>Run (type in the command and press enter): <code class="language-plaintext highlighter-rouge">ipconfig /all</code></p>

<p>You should receive output similar to this:</p>

<p><img src="debian_images/macs_1.png" width="100%" /></p>

<p>Note the two highlighted addresses on a different media or a sheet of paper. Don‚Äôt close the terminal as it will be needed in the next step.</p>

<h3 id="install-the-device-tree-on-the-efi-system-partition">Install the Device Tree on the EFI System Partition</h3>
<p>Download the file pointed by this link (right click -&gt; save as): https://d-i.debian.org/daily-images/arm64/daily/device-tree/qcom/sc8280xp-lenovo-thinkpad-x13s.dtb</p>

<p>With the terminal still open type <code class="language-plaintext highlighter-rouge">diskpart.exe</code> and press enter. When diskpart opens, type <code class="language-plaintext highlighter-rouge">list volume</code> and press enter. It will list available volumes that look similar to this:</p>

<p><img src="debian_images/dt_1.png" width="100%" /></p>

<p>Look at the volumes and find the number of the one with Label <code class="language-plaintext highlighter-rouge">SYSTEM</code> and Fs <code class="language-plaintext highlighter-rouge">FAT32</code>. As highlighted in this case it‚Äôs number 1.</p>

<p>Run <code class="language-plaintext highlighter-rouge">select volume 1</code> (or a different number you found) and then run <code class="language-plaintext highlighter-rouge">assign</code>.</p>

<p>You should now see a new drive in <code class="language-plaintext highlighter-rouge">This PC</code> view called <code class="language-plaintext highlighter-rouge">SYSTEM</code> and the letter assigned to it, in this case it‚Äôs <code class="language-plaintext highlighter-rouge">D:</code></p>

<p><img src="debian_images/dt_2.png" width="100%" /></p>

<p>Go back to the Command Line, and run <code class="language-plaintext highlighter-rouge">exit</code> to close the DiskPart.</p>

<p>To verify that the correct partition was selected type run <code class="language-plaintext highlighter-rouge">ls D:</code> (or a different letter if that‚Äôs your case). The partition should contain EFI directory:</p>

<p><img src="debian_images/dt_3.png" width="100%" /></p>

<p>Now copy the downloaded device tree by running:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp .\Downloads\sc8280xp-lenovo-thinkpad-x13s.dtb D:\
</code></pre></div></div>

<p>And verify that file was copied by running <code class="language-plaintext highlighter-rouge">ls D:</code> again:</p>

<p><img src="debian_images/dt_4.png" width="100%" /></p>

<h3 id="prepare-usb-stick-for-installation">Prepare USB stick for installation</h3>
<p>Download the <a href="https://cdimage.debian.org/cdimage/daily-builds/sid_d-i/arch-latest/arm64/iso-cd/debian-testing-arm64-netinst.iso">daily netinst image of Debian</a> and <a href="https://github.com/pbatard/rufus/releases/download/v4.3/rufus-4.3_arm64.exe">Rufus</a>.</p>

<p>Plug in your second USB drive and open Rufus. Select your USB drive and the downloaded Debian image. You don‚Äôt need to change any default settings. It should look similar to this:</p>

<p><img src="debian_images/rufus_1.png" width="100%" /></p>

<p><span style="color:red">Note: all data on this drive will be deleted.</span></p>

<p>Press <code class="language-plaintext highlighter-rouge">START</code>, then read and accept the pop-ups to flash. Again, default settings should not be changed.</p>

<p>After flashing finishes, shutdown Windows and keep the USB drive plugged in.</p>

<h3 id="configure-the-bios">Configure the BIOS</h3>
<p>Reboot your ThinkPad and when you see the Lenovo logo on boot press <code class="language-plaintext highlighter-rouge">F1</code> to enter the BIOS. It will look like this:</p>

<p><img src="debian_images/bios_1.jpg" width="100%" /></p>

<p>Click on the Config section on the left, and then Linux:</p>

<p><img src="debian_images/bios_2.jpg" width="100%" /></p>

<p>Then turn on <code class="language-plaintext highlighter-rouge">Linux Boot</code> option:</p>

<p><img src="debian_images/bios_3.jpg" width="100%" /></p>

<p>Go back to the <code class="language-plaintext highlighter-rouge">Security</code> section and into the <code class="language-plaintext highlighter-rouge">Secure Boot</code> configuration:</p>

<p><img src="debian_images/bios_4.jpg" width="100%" /></p>

<p>Disable the <code class="language-plaintext highlighter-rouge">Secure Boot</code>:</p>

<p><img src="debian_images/bios_5.jpg" width="100%" /></p>

<p>Go back to the <code class="language-plaintext highlighter-rouge">Restart</code> section and select <code class="language-plaintext highlighter-rouge">Exit Saving changes</code>. Your laptop will now reboot.</p>

<p><img src="debian_images/bios_6.jpg" width="100%" /></p>

<h2 id="installation">Installation</h2>
<h3 id="boot-debian-installer">Boot Debian Installer</h3>
<p>Make sure that the USB stick with Debian image is plugged in. Turn your laptop off and on again. When you see the Lenovo logo press F12 to select booting from the USB.</p>

<p>You should see the choice of <code class="language-plaintext highlighter-rouge">USB-HDD</code> with the name of your drive, in this case <code class="language-plaintext highlighter-rouge">Samsung Type-C</code>. Select it.</p>

<p>Note: If your USB drive doesn‚Äôt show up, hold down the power button for 10 seconds to shutdown, remove and insert your USB stick and try again.</p>

<p><img src="debian_images/boot_1.jpg" width="100%" /></p>

<p>You will be greeted with a blue GRUB‚Äôs screen:</p>

<p><img src="debian_images/boot_2.jpg" width="100%" /></p>

<p>Use arrow keys to highlight the <code class="language-plaintext highlighter-rouge">Graphical install</code> option and press ‚Äúe‚Äù. You will see a text editor. Using arrow keys move the cursor to the end of the line starting with <code class="language-plaintext highlighter-rouge">linux</code>:</p>

<p><img src="debian_images/boot_3.jpg" width="100%" /></p>

<p>Replace the word <code class="language-plaintext highlighter-rouge">quiet</code> with <code class="language-plaintext highlighter-rouge">arm64.nopauth</code></p>

<p><img src="debian_images/boot_4.jpg" width="100%" /></p>

<p>Finally, press <code class="language-plaintext highlighter-rouge">Ctrl + X</code> to boot the installer.</p>

<h3 id="first-steps">First steps</h3>
<p>If the font is too small, you can increase it by pressing <code class="language-plaintext highlighter-rouge">Ctrl+</code>, which is <code class="language-plaintext highlighter-rouge">Ctrl + Shift + "+/= key"</code> a few times. To decrease it press <code class="language-plaintext highlighter-rouge">Ctrl -</code></p>

<p>Follow the installation steps as below until you reach the <code class="language-plaintext highlighter-rouge">Partition disks</code> section:</p>
<ol>
  <li>Select your language and region.</li>
  <li>Select your Wi-Fi network, encryption type (most likely WPA/WPA2) and password.</li>
  <li>Type in the hostname according to your preferences - for example DebianX13s. If you don‚Äôt know what it‚Äôs for, you can skip setting up the domain name.</li>
  <li>Set up your root password.</li>
  <li>Set up your full user name, short username and it‚Äôs password</li>
</ol>

<h3 id="disk-partitioning">Disk partitioning</h3>
<p>After reaching <code class="language-plaintext highlighter-rouge">Partition disks</code> section, select <code class="language-plaintext highlighter-rouge">Manual</code> in order to shrink Windows Partition and configure encrypted LVM module for Debian:</p>

<p><img src="debian_images/part_01.png" width="100%" /></p>

<h4 id="resize-windows">Resize Windows</h4>
<p>Depending on your SSD model and size, you will see a list similar to this. Windows partition will likely be the biggest ntfs volume on your drive. Select it and press continue.</p>

<p><img src="debian_images/part_02.png" width="100%" /></p>

<p>Select <code class="language-plaintext highlighter-rouge">Resize the partition</code> and press continue. If you‚Äôre asked about writing previous changes, select <code class="language-plaintext highlighter-rouge">Yes</code> and continue:</p>

<p><img src="debian_images/part_03.png" width="100%" /></p>

<p><img src="debian_images/part_04.png" width="100%" /></p>

<p>You will see how much space can be reclaimed. Leave at least 20GB above minimum so the system can be usable later:</p>

<p><img src="debian_images/part_05.png" width="100%" /></p>

<h4 id="create-boot-partition">Create boot partition</h4>
<p>After resizing is done, you will see a <code class="language-plaintext highlighter-rouge">FREE SPACE</code> after the Windows partition. Select it and then select <code class="language-plaintext highlighter-rouge">Create a new partition</code>:</p>

<p><img src="debian_images/part_06.png" width="100%" /></p>

<p><img src="debian_images/part_07.png" width="100%" /></p>

<p>Set its size to 512MB and the location for the new partition at the beginning:</p>

<p><img src="debian_images/part_08.png" width="100%" /></p>

<p><img src="debian_images/part_09.png" width="100%" /></p>

<p>In the partition configuration menu select <code class="language-plaintext highlighter-rouge">Mount point</code> to <code class="language-plaintext highlighter-rouge">/boot</code>. The final configuration should look like this:</p>

<p><img src="debian_images/part_10.png" width="100%" /></p>

<p>Then select <code class="language-plaintext highlighter-rouge">Done setting up the partition</code>.</p>

<h4 id="create-encrypted-volume">Create encrypted volume</h4>
<p>After the boot partition is created, your partition list should look as below. Now select <code class="language-plaintext highlighter-rouge">Configure encrypted volumes</code>:</p>

<p><img src="debian_images/part_11.png" width="100%" /></p>

<p>You will be asked again to write the changes to the disk. Select <code class="language-plaintext highlighter-rouge">Yes</code>.</p>

<p>Choose <code class="language-plaintext highlighter-rouge">Create encrypted volumes</code> and select the largest <code class="language-plaintext highlighter-rouge">FREE SPACE</code> section on your disk:</p>

<p><img src="debian_images/part_12.png" width="100%" /></p>

<p>In the next step don‚Äôt change any default settings. Simply select <code class="language-plaintext highlighter-rouge">Done setting up the partition</code>.</p>

<p>You will be asked again to write the changes to the disk. Select <code class="language-plaintext highlighter-rouge">Yes</code>.</p>

<p>As the encrypted volume is now created, select <code class="language-plaintext highlighter-rouge">Finish</code>.</p>

<p>You will be asked if you want to securely erase the created volume. If you are unsure what to choose, select yes and wait for the process to finish. Depending on the size of your disk it may take a while (coffee break recommended):</p>

<p><img src="debian_images/part_13.png" width="100%" /></p>

<p>After erasing is finished, you will be asked to provide the disk encryption password (make it strong):</p>

<p><img src="debian_images/part_14.png" width="100%" /></p>

<h4 id="configuring-the-lvm">Configuring the LVM</h4>
<p>After creating encrypted volume, your disk partitions should look like below. Select <code class="language-plaintext highlighter-rouge">Configure the Logical Volume Manager</code>:</p>

<p><img src="debian_images/part_15.png" width="100%" /></p>

<p>You will be asked again to write changes to the disk. Select <code class="language-plaintext highlighter-rouge">Yes</code>.</p>

<p>Now we see an empty LVM configuration. Select <code class="language-plaintext highlighter-rouge">Create volume group</code> and call it for example <code class="language-plaintext highlighter-rouge">debian-vg</code>:</p>

<p><img src="debian_images/part_16.png" width="100%" /></p>

<p><img src="debian_images/part_17.png" width="100%" /></p>

<p>Select the encrypted volume to use it in volume group:</p>

<p><img src="debian_images/part_18.png" width="100%" /></p>

<p>Now in the main LVM configuration menu you will see 1 used physical volume. Let‚Äôs create two logical volumes: one will be used as a swap and the other to store system and files.
Select <code class="language-plaintext highlighter-rouge">Create logical volume</code> and use <code class="language-plaintext highlighter-rouge">debian-vg</code> group:</p>

<p><img src="debian_images/part_19.png" width="100%" /></p>

<p><img src="debian_images/part_20.png" width="100%" /></p>

<p>We will call first LVM volume <code class="language-plaintext highlighter-rouge">swap</code> and we will allocate 4GB of disk space for it. If your Thinkpad is equipped with 8GB of RAM, you may want to increase it to 8GB:</p>

<p><img src="debian_images/part_21.png" width="100%" /></p>

<p><img src="debian_images/part_22.png" width="100%" /></p>

<p>Now create a second logical volume called <code class="language-plaintext highlighter-rouge">root</code> allocating the rest of space for it (it should be pre-filled).</p>

<p><img src="debian_images/part_23.png" width="100%" /></p>

<p><img src="debian_images/part_24.png" width="100%" /></p>

<p>After both logical volumes are created, you may choose <code class="language-plaintext highlighter-rouge">Display configuration details</code> to verify that both volumes are correctly allocated:</p>

<p><img src="debian_images/part_25.png" width="100%" /></p>

<p>If that‚Äôs the case, select <code class="language-plaintext highlighter-rouge">Finish</code> and go back to the disk partitioning view.</p>

<h4 id="assign-mount-points-for-root-and-swap-partitions">Assign mount points for root and swap partitions</h4>
<p>After LVM configuration is done, the partition list should look like below. Select the partition under <code class="language-plaintext highlighter-rouge">LV root</code> to configure it:</p>

<p><img src="debian_images/part_26.png" width="100%" /></p>

<p>Change <code class="language-plaintext highlighter-rouge">Use as:</code> from <code class="language-plaintext highlighter-rouge">do not use</code> to the <code class="language-plaintext highlighter-rouge">Ext4 journaling file system</code>:</p>

<p><img src="debian_images/part_27.png" width="100%" /></p>

<p><img src="debian_images/part_28.png" width="100%" /></p>

<p>Then change the <code class="language-plaintext highlighter-rouge">Mount point</code> from <code class="language-plaintext highlighter-rouge">none</code> to <code class="language-plaintext highlighter-rouge">/ - the root file system</code>. After changing it should look like below. Select <code class="language-plaintext highlighter-rouge">Done setting up the partition</code> and continue.</p>

<p><img src="debian_images/part_29.png" width="100%" /></p>

<p>Now enter the partition under LV swap and change <code class="language-plaintext highlighter-rouge">Use as</code> from <code class="language-plaintext highlighter-rouge">do not use</code> to <code class="language-plaintext highlighter-rouge">swap area</code>:</p>

<p><img src="debian_images/part_30.png" width="100%" /></p>

<p><img src="debian_images/part_31.png" width="100%" /></p>

<p>Select <code class="language-plaintext highlighter-rouge">Done setting up the partition</code> and continue.</p>

<p>The final disk configuration will look like below. Select <code class="language-plaintext highlighter-rouge">Finish partitioning and write changes to disk</code> and continue.</p>

<p><img src="debian_images/part_32.png" width="100%" /></p>

<p>You will be asked again to write changes to the disk. Select <code class="language-plaintext highlighter-rouge">Yes</code>.</p>

<h3 id="system-installation">System installation</h3>
<p>Wait for the installer to install the base system.
In the next steps:</p>
<ul>
  <li>Configure the package manager based on your location and configure the proxy (if you use one).</li>
  <li>Installer will then download and install other missing packages.</li>
  <li>Configure the popularity contest aka. anonymous data collection according to your preferences.</li>
  <li>Make sure to select <code class="language-plaintext highlighter-rouge">Debian desktop environment</code> or any other GUI that you prefer:</li>
</ul>

<p><img src="debian_images/install_1.png" width="100%" /></p>

<p>and wait for installation to finish‚Ä¶</p>

<p>You will be asked whether to force GRUB installation to the EFI removable media path and to Update NVRAM variables. Select Yes in both cases and continue.</p>

<p><img src="debian_images/install_2.png" width="100%" /></p>

<p><img src="debian_images/install_3.png" width="100%" /></p>

<h3 id="final-steps">Final steps</h3>
<p>Wait until you see <code class="language-plaintext highlighter-rouge">Installation complete</code> screen as below:</p>

<p><img src="debian_images/install_4.png" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Ctrl + Alt + Fn + F2</code>, then press enter to activate the console:</p>

<p><img src="debian_images/install_5.jpg" width="100%" /></p>

<h4 id="add-initramfs-modules">Add initramfs modules</h4>
<p>Run in the following command in the console to edit the modules file:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /target/etc/initramfs-tools/modules
</code></pre></div></div>

<p><img src="debian_images/install_6.jpg" width="100%" /></p>

<p>A text editor will open. Add the following lines to the end of the file:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>leds_qcom_lpg
qrtr
pmic_glink_altmode
gpio_sbu_mux
qnoc-sc8280xp
</code></pre></div></div>

<p>It should look like this:</p>

<p><img src="debian_images/install_7.jpg" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Ctrl + x</code> to exit the editor, then press <code class="language-plaintext highlighter-rouge">y</code> and <code class="language-plaintext highlighter-rouge">enter</code> to save the file.</p>

<p>To apply the config we modified run the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>in-target update-initramfs -u -k all
</code></pre></div></div>
<h4 id="install-missing-packages">Install missing packages</h4>
<p>There are few packages that are necessary to use the ThinkPad, but they are not installed by default so let‚Äôs do that manually by running the command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>in-target apt install -y firmware-qcom-soc protection-domain-mapper qrtr-tools acpi
</code></pre></div></div>

<p>Now go back to the graphical interface by pressing <code class="language-plaintext highlighter-rouge">Ctrl + Alt + Fn + F5</code> and press continue to reboot.</p>

<p><img src="debian_images/install_4.png" width="100%" /></p>

<h3 id="first-boot">First boot</h3>
<p>Upon the next boot, when you see the Lenovo logo, press <code class="language-plaintext highlighter-rouge">F12</code> and manually select booting from NVMe drive. You will see a blue screen, wait for 5 seconds and the system will boot next time into Debian. This step is needed only once.</p>

<p><img src="debian_images/install_8.jpg" width="100%" /></p>

<h2 id="post-installation-fixes">Post installation fixes</h2>
<p>After you successfully booted and logged into Debian, there are two more fixes we need to apply.</p>

<h3 id="fix-wi-fi-and-bluetooth-mac-addresses">Fix Wi-Fi and Bluetooth mac addresses</h3>
<p>In this step we will use mac addresses noted on Windows.</p>

<p>Click on the <code class="language-plaintext highlighter-rouge">Activities</code> in the top right corner (or press a Windows key), type in <code class="language-plaintext highlighter-rouge">terminal</code> and open it.</p>

<p>Run the <code class="language-plaintext highlighter-rouge">su</code> command to became a superuser. You will need to enter the root password that you set during installation.</p>

<p>Create udev rules file by opening it in nano:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/udev/rules.d/99-fix_mac_addresses.rules
</code></pre></div></div>

<p><img src="debian_images/postinst_1.png" width="100%" /></p>

<p>Copy and paste the following content to the file. Replace <code class="language-plaintext highlighter-rouge">XX:XX:XX:XX:XX:XX</code> with the Wi-Fi mac address noted on Windows (also replace <code class="language-plaintext highlighter-rouge">-</code> with <code class="language-plaintext highlighter-rouge">:</code>).</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ACTION=="add", SUBSYSTEM=="net", KERNELS=="0006:01:00.0", \
  RUN+="/usr/sbin/ip link set dev wlP6p1s0 address XX:XX:XX:XX:XX:XX"
ACTION=="add", SUBSYSTEM=="bluetooth", ENV{DEVTYPE}=="host" \
  ENV{DEVPATH}=="*/serial[0-9]*/serial[0-9]*/bluetooth/hci[0-9]*", \
  TAG+="systemd", ENV{SYSTEMD_WANTS}="hci-btaddress@%k.service"
</code></pre></div></div>

<p><img src="debian_images/postinst_2.png" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Ctrl + x</code> and then press <code class="language-plaintext highlighter-rouge">y</code> and enter to save the changes.</p>

<p>Run the next command to create systemd service for bluetooth:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /lib/systemd/system/hci-btaddress@.service
</code></pre></div></div>

<p>Copy and paste the following content to the file. Replace <code class="language-plaintext highlighter-rouge">XX:XX:XX:XX:XX:XX</code> with the Bluetooth mac address noted on Windows (also replace <code class="language-plaintext highlighter-rouge">-</code> with <code class="language-plaintext highlighter-rouge">:</code>).</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=HCI bluetooth address fix

[Service]
Type=simple
ExecStart=/bin/sh -c 'sleep 5 &amp;&amp; yes | btmgmt -i %I public-addr XX:XX:XX:XX:XX:XX'
</code></pre></div></div>

<p><img src="debian_images/postinst_3.png" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Ctrl + x</code> and then press y and enter to save the changes.</p>

<p>Run <code class="language-plaintext highlighter-rouge">systemctl daemon-reload</code> to update the systemd config. Changes will take place after a reboot, but we can do it after the next step.</p>

<h3 id="fix-usb-throughput-and-improve-power-efficiency">Fix USB throughput and improve power efficiency</h3>
<p>Edit a grub config file by running:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/default/grub
</code></pre></div></div>
<p>You should now see a file looking like this:</p>

<p><img src="debian_images/postinst_4.png" width="100%" /></p>

<p>Go down to the line starting with <code class="language-plaintext highlighter-rouge">GRUB_CMDLINE_LINUX_DEFAULT</code> and modify the value in quotation marks so it looks like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRUB_CMDLINE_LINUX_DEFAULT="iommu.passthrough=0 iommu.strict=0 pcie_aspm.policy=powersupersave quiet"
</code></pre></div></div>
<p>You can also add a word <code class="language-plaintext highlighter-rouge">splash</code> there, to have a nice looking screen when typing disk decryption password instead of a text mode. In the end it should look like this:</p>

<p><img src="debian_images/postinst_5.png" width="100%" /></p>

<p>Press <code class="language-plaintext highlighter-rouge">Ctrl + X</code>` and then press y and enter to save the changes.</p>

<p>To apply the changes to the GRUB config run the two commands:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=/sbin:$PATH
update-grub
</code></pre></div></div>

<p>Now you can reboot your ThinkPad to apply all the changes. Enjoy!</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AArch64 Laptops</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">üíª with ü©∂</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/aarch64-laptops"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">aarch64-laptops</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Providing the GNU/Linux community with resources for Arm laptops since 2019!</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
